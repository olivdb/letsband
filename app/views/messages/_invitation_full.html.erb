<% provide(:title, "Invitation") %> 
<% friend = current_user?(@message.sender) ? @message.recipient : @message.sender %>
<div class="invitation_full">
<p>
	Date: <%= @message.created_at %>
</p>
<p>
	<%= gravatar_for friend %>
	<%= link_to friend.name, friend %>
</p>

	<em><%= @message.subject.blank? ? '(No subject)' : @message.subject %></em>

	<table class="invitation_buttons"><tr>
	<% membership = Membership.where(band_id: @message.inviting_band_id, user_id: current_user.id).first %>
	<% if (membership.try(:role) == "invited") && can?(:convert_to_member, membership) %>
		<td><%= (button_to "Accept invitation", convert_to_member_membership_path(membership), :method => "get", class: "btn btn-primary btn-small") %></td>
	<% end %>
	<% if (membership.try(:role) == "invited") && can?(:destroy, membership) %>
		<td><%= form_for(membership, html: { method: :delete }, remote: true) do |f| %>
			<%= f.submit "Turn down invitation", confirm: "Are you sure you want to turn down this invitation ?", class: "btn btn-small btn-primary" %>
		<% end %></td>
	<% end %>
	</tr></table>

<p>
	<%= link_to 'Reply', new_message_path(recipient_id: friend.id, subject: ((@message.subject[0..2]=='Re:') ? '' : 'Re: ') + @message.subject) %>
</p>
</div>
